<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uniformes Don Bosco - Sistema de Ventas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
            padding: 20px;
        }

        .menu-btn {
            height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .menu-btn i {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .card {
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .prenda-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .prenda-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .seccion-content {
            display: none;
        }

        #nuevaVenta {
            display: block;
        }

        .form-control-lg, .form-select-lg {
            font-size: 1.1rem;
            padding: 0.8rem;
        }

        .total-section {
            font-size: 1.5rem;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .menu-btn {
                font-size: 1.2rem; /* Ajusta el tamaño de fuente en móviles */
            }

            .total-section {
                font-size: 1.2rem; /* Ajusta el tamaño de la sección total */
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <header class="text-center py-3">
            <h1 class="display-4">Uniformes Don Bosco</h1>
        </header>

        <!-- Botones principales -->
        <div class="row mb-4">
            <div class="col-md-3">
                <button class="btn btn-primary btn-lg w-100 menu-btn" onclick="mostrarSeccion('nuevaVenta')">
                    <i class="fas fa-shopping-cart"></i>Nueva Venta
                </button>
            </div>
            <div class="col-md-3">
                <button class="btn btn-success btn-lg w-100 menu-btn" onclick="mostrarSeccion('pedidosPendientes')">
                    <i class="fas fa-list"></i>Pedidos Pendientes
                </button>
            </div>
            <div class="col-md-3">
                <button class="btn btn-warning btn-lg w-100 menu-btn" onclick="mostrarSeccion('inventario')">
                    <i class="fas fa-boxes"></i>Inventario
                </button>
            </div>
            <div class="col-md-3">
                <button class="btn btn-info btn-lg w-100 menu-btn" onclick="descargarExcel()">
                    <i class="fas fa-file-excel"></i>Descargar Excel
                </button>
            </div>
        </div>

        <!-- Sección Nueva Venta -->
        <div id="nuevaVenta" class="seccion-content">
            <div class="card p-4">
                <h2>Nueva Venta</h2>
                <form id="formularioVenta" onsubmit="guardarVenta(event)">
                    <div class="row">
                        <!-- Datos del cliente -->
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Número de Factura</label>
                                <input type="text" class="form-control form-control-lg" id="numeroFactura" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Nombre del Cliente</label>
                                <input type="text" class="form-control form-control-lg" id="nombreCliente" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Teléfono</label>
                                <input type="tel" class="form-control form-control-lg" id="telefono" required>
                            </div>
                        </div>

                        <!-- Selección de prendas -->
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label class="form-label">Tipo de Uniforme</label>
                                <select class="form-select form-select-lg" id="tipoUniforme" onchange="mostrarPrendas()">
                                    <option value="primaria">Primaria</option>
                                    <option value="bachillerato">Bachillerato</option>
                                </select>
                            </div>
                            <div id="listaPrendas" class="row">
                                <!-- Las prendas se cargarán aquí -->
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de prendas seleccionadas -->
                    <div class="row mt-4">
                        <div class="col-md-8">
                            <table class="table" id="tablaPrendas">
                                <thead>
                                    <tr>
                                        <th>Prenda</th>
                                        <th>Talla</th>
                                        <th>Precio</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-light p-3">
                                <div class="total-section mb-3">
                                    Total: $<span id="totalVenta">0</span>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Método de Pago</label>
                                    <select class="form-select form-select-lg" id="metodoPago">
                                        <option value="efectivo">Efectivo</option>
                                        <option value="nequi">Nequi</option>
                                        <option value="daviplata">Daviplata</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Estado</label>
                                    <select class="form-select form-select-lg" id="estadoPedido">
                                        <option value="entregado">Entregado</option>
                                        <option value="pendiente">Pendiente</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary btn-lg w-100">Guardar Venta</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Sección Pedidos Pendientes -->
        <div id="pedidosPendientes" class="seccion-content">
            <div class="card p-4">
                <h2>Pedidos Pendientes</h2>
                <table class="table" id="tablaPedidosPendientes">
                    <thead>
                        <tr>
                            <th>Número de Factura</th>
                            <th>Cliente</th>
                            <th>Teléfono</th>
                            <th>Prendas</th>
                            <th>Total</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Sección Inventario -->
        <div id="inventario" class="seccion-content">
            <div class="card p-4">
                <h2>Inventario</h2>
                <div id="resumenInventario"></div>
            </div>
        </div>
    </div>

    <script>
        const PRENDAS = {
            primaria: {
                buso_sudadera: {
                    nombre: "Buso Sudadera",
                    tallas: ['4', '6', '8', '10', '12', '14', '16', 'S'],
                    precios: {
                        '4': 70000, '6': 70000, '8': 70000, '10': 76000, 
                        '12': 76000, '14': 80000, '16': 80000, 'S': 85000
                    }
                },
                pantalon_sudadera: {
                    nombre: "Pantalón Sudadera",
                    tallas: ['4', '6', '8', '10', '12', '14', '16', 'S'],
                    precios: {
                        '4': 40000, '6': 40000, '8': 40000, '10': 45000, 
                        '12': 45000, '14': 50000, '16': 50000, 'S': 55000
                    }
                },
                camiseta_deportiva: {
                    nombre: "Camiseta Deportiva",
                    tallas: ['4', '6', '8', '10', '12', '14', '16', 'S'],
                    precios: {
                        '4': 25000, '6': 25000, '8': 25000, '10': 30000, 
                        '12': 30000, '14': 35000, '16': 35000, 'S': 35000
                    }
                },
                pantaloneta: {
                    nombre: "Pantaloneta",
                    tallas: ['4', '6', '8', '10', '12', '14', '16', 'S'],
                    precios: {
                        '4': 20000, '6': 20000, '8': 20000, '10': 22000, 
                        '12': 22000, '14': 25000, '16': 25000, 'S': 28000
                    }
                },
                pantalon_nino: {
                    nombre: "Pantalón Niño",
                    tallas: ['6', '8', '10', '12', '14', '16', 'S'],
                    precios: {
                        '6': 38000, '10': 40000, '14': 45000, 'S': 45000
                    }
                },
                camibuso_nino: {
                    nombre: "Camibuso Niño",
                    tallas: ['6', '8', '10', '12', '14', '16', 'S'],
                    precios: {
                        '6': 35000, '10': 38000, '14': 40000, 'S': 42000
                    }
                },
                jardinera: {
                    nombre: "Jardinera (Grado 3, 4, 5)",
                    tallas: ['10', '12', '14', '16'],
                    precios: {
                        '10': 78000, '12': 78000, '14': 80000, '16': 82000
                    }
                },
                bata_nina: {
                    nombre: "Bata Niña (Grado 0, 1, 2)",
                    tallas: ['4', '6', '8', '10', '12', '14'],
                    precios: {
                        '6': 60000, '8': 64000, '10': 68000, '12': 70000, '14': 79000
                    }
                }
            },
            bachillerato: {
                sudadera: {
                    nombre: "Sudadera",
                    tallas: ['10', '12', '14', '16', 'S', 'M', 'L', 'XL', 'XXL'],
                    precios: {
                        '10': 115000, '12': 115000, '14': 120000, '16': 130000,
                        'S': 140000, 'M': 145000, 'L': 150000, 'XL': 155000, 'XXL': 160000
                    }
                },
                chaqueta_sudadera: {
                    nombre: "Chaqueta Sudadera",
                    tallas: ['10', '12', '14', '16', 'S', 'M', 'L', 'XL', 'XXL'],
                    precios: {
                        '10': 68000, '12': 70000, '14': 74000, '16': 80000,
                        'S': 85000, 'M': 90000, 'L': 90000, 'XL': 95000, 'XXL': 97000
                    }
                },
                pantalon_sudadera: {
                    nombre: "Pantalón Sudadera",
                    tallas: ['10', '12', '14', '16', 'S', 'M', 'L', 'XL', 'XXL'],
                    precios: {
                        '10': 46000, '12': 46000, '14': 48000, '16': 51000,
                        'S': 53000, 'M': 55000, 'L': 58000, 'XL': 62000, 'XXL': 65000
                    }
                },
                chaqueta_diario: {
                    nombre: "Chaqueta Diario",
                    tallas: ['10', '12', '14', '16', 'S', 'M', 'L', 'XL', 'XXL'],
                    precios: {
                        '10': 78000, '12': 78000, '14': 80000, '16': 80000,
                        'S': 85000, 'M': 90000, 'L': 90000, 'XL': 95000, 'XXL': 100000
                    }
                },
                saco_azul: {
                    nombre: "Saco Azul",
                    tallas: ['10', '12', '14', '16', 'S', 'M', 'L', 'XL', 'XXL'],
                    precios: {
                        '10': 64000, '12': 64000, '14': 66000, '16': 67000,
                        'S': 70000, 'M': 72000, 'L': 75000, 'XL': 78000, 'XXL': 80000
                    }
                },
                overol: {
                    nombre: "Overol",
                    precio: 75000
                },
                bata_azul: {
                    nombre: "Bata Azul",
                    tallas: ['12', '14', '16'],
                    precio: 55000,
                    medidas: true
                },
                bata_blanca: {
                    nombre: "Bata Blanca",
                    tallas: ['12', '14', '16'],
                    precio: 55000,
                    medidas: true
                }
            }
        };

        let prendasSeleccionadas = [];
        let ventasGuardadas = JSON.parse(localStorage.getItem('ventas')) || [];

        function mostrarSeccion(seccionId) {
            document.querySelectorAll('.seccion-content').forEach(seccion => {
                seccion.style.display = 'none';
            });
            document.getElementById(seccionId).style.display = 'block';
            
            if (seccionId === 'pedidosPendientes') {
                actualizarTablaPedidos();
            } else if (seccionId === 'inventario') {
                actualizarInventario();
            }
        }

        function mostrarPrendas() {
            const tipoUniforme = document.getElementById('tipoUniforme').value;
            const listaPrendas = document.getElementById('listaPrendas');
            listaPrendas.innerHTML = '';

            Object.entries(PRENDAS[tipoUniforme]).forEach(([key, prenda]) => {
                const div = document.createElement('div');
                div.className = 'col-md-4 mb-3';
                div.innerHTML = `
                    <div class="card prenda-card" onclick="seleccionarPrenda('${key}', '${tipoUniforme}')">
                        <div class="card-body">
                            <h5 class="card-title">${prenda.nombre}</h5>
                            <p class="card-text">Desde: $${obtenerPrecioMinimo(prenda)}</p>
                        </div>
                    </div>
                `;
                listaPrendas.appendChild(div);
            });
        }

        function obtenerPrecioMinimo(prenda) {
            if (prenda.precio) return prenda.precio;
            const precios = Object.values(prenda.precios).filter(p => p > 0);
            return Math.min(...precios);
        }

        function seleccionarPrenda(prendaKey, tipoUniforme) {
            const prenda = PRENDAS[tipoUniforme][prendaKey];
            
            // Crear modal para selección de talla
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">${prenda.nombre}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label">Talla</label>
                                <select class="form-select" id="selectTalla">
                                    ${prenda.tallas.map(talla => 
                                        `<option value="${talla}">${talla} - $${prenda.precios[talla] || prenda.precio}</option>`
                                    ).join('')}
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" onclick="agregarPrenda('${prendaKey}', '${tipoUniforme}')" data-bs-dismiss="modal">
                                Agregar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();
            
            modal.addEventListener('hidden.bs.modal', () => {
                modal.remove();
            });
        }

        function agregarPrenda(prendaKey, tipoUniforme) {
            const prenda = PRENDAS[tipoUniforme][prendaKey];
            const talla = document.getElementById('selectTalla').value;
            const precio = prenda.precios[talla] || prenda.precio;

            prendasSeleccionadas.push({
                nombre: prenda.nombre,
                talla,
                precio
            });

            actualizarTablaPrendas();
            actualizarTotal();
        }

        function actualizarTablaPrendas() {
            const tbody = document.querySelector('#tablaPrendas tbody');
            tbody.innerHTML = '';

            prendasSeleccionadas.forEach((prenda, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${prenda.nombre}</td>
                    <td>${prenda.talla}</td>
                    <td>$${prenda.precio.toLocaleString()}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="eliminarPrenda(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function eliminarPrenda(index) {
            prendasSeleccionadas.splice(index, 1);
            actualizarTablaPrendas();
            actualizarTotal();
        }

        function actualizarTotal() {
            const total = prendasSeleccionadas.reduce((sum, prenda) => sum + prenda.precio, 0);
            document.getElementById('totalVenta').textContent = total.toLocaleString();
        }

        function guardarVenta(event) {
            event.preventDefault();

            const venta = {
                factura: document.getElementById('numeroFactura').value,
                cliente: document.getElementById('nombreCliente').value,
                telefono: document.getElementById('telefono').value,
                metodoPago: document.getElementById('metodoPago').value,
                estado: document.getElementById('estadoPedido').value,
                prendas: prendasSeleccionadas,
                total: prendasSeleccionadas.reduce((sum, prenda) => sum + prenda.precio, 0),
                fecha: new Date().toISOString()
            };

            ventasGuardadas.push(venta);
            localStorage.setItem('ventas', JSON.stringify(ventasGuardadas));

            alert('Venta guardada exitosamente');
            limpiarFormulario();
        }

        function limpiarFormulario() {
            document.getElementById('formularioVenta').reset();
            prendasSeleccionadas = [];
            actualizarTablaPrendas();
            actualizarTotal();
        }

        function actualizarTablaPedidos() {
            const tbody = document.querySelector('#tablaPedidosPendientes tbody');
            tbody.innerHTML = '';

            ventasGuardadas.forEach((venta, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${venta.factura}</td>
                    <td>${venta.cliente}</td>
                    <td>${venta.telefono}</td>
                    <td>${venta.prendas.map(p => `${p.nombre} (${p.talla})`).join(', ')}</td>
                    <td>$${venta.total.toLocaleString()}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="eliminarRecibo(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function eliminarRecibo(index) {
            ventasGuardadas.splice(index, 1);
            localStorage.setItem('ventas', JSON.stringify(ventasGuardadas));
            actualizarTablaPedidos();
        }

        function actualizarInventario() {
            const resumen = {};
            
            ventasGuardadas
                .filter(venta => venta.estado === 'pendiente')
                .forEach(venta => {
                    venta.prendas.forEach(prenda => {
                        const key = `${prenda.nombre} - ${prenda.talla}`;
                        resumen[key] = (resumen[key] || 0) + 1;
                    });
                });

            const inventarioDiv = document.getElementById('resumenInventario');
            inventarioDiv.innerHTML = '<div class="row">';
            
            Object.entries(resumen).forEach(([prenda, cantidad]) => {
                inventarioDiv.innerHTML += `
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">${prenda}</h5>
                                <p class="card-text">Cantidad: ${cantidad}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            inventarioDiv.innerHTML += '</div>';
        }

        function descargarExcel() {
            const datos = ventasGuardadas.map(venta => ({
                'Número Factura': venta.factura,
                'Cliente': venta.cliente,
                'Teléfono': venta.telefono,
                'Método Pago': venta.metodoPago,
                'Estado': venta.estado,
                'Total': venta.total,
                'Fecha': new Date(venta.fecha).toLocaleDateString(),
                'Prendas': venta.prendas.map(p => `${p.nombre} (${p.talla})`).join(', ')
            }));

            const worksheet = XLSX.utils.json_to_sheet(datos);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Ventas");
            XLSX.writeFile(workbook, `Ventas_${new Date().toLocaleDateString()}.xlsx`);
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', () => {
            mostrarPrendas();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
</body>
</html>
